<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sneke Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="./manifest.json">
    <link rel='stylesheet' href='./style.css'>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <script>
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js');
        };
    </script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="PWA Example">
    <link rel="apple-touch-icon" href="icon-152x152.png">
    <meta name="msapplication-TileImage" content="icon-144x144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
     <style>
        /* Retro Green/Black Palette */
        :root {
            --board-color: #333;
            --grid-line-color: #222;
            --snake-color: #00FF00;
            --food-color: #FF0000;
            --text-color: #00FF00;
        }

        body {
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #111;
            font-family: 'Monospace', monospace;
            color: var(--text-color);
            user-select: none;
            padding: 10px; /* Overall padding for mobile view */
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 5px solid var(--text-color);
            padding: 10px;
            background-color: var(--board-color);
            box-shadow: 0 0 20px var(--text-color);
            margin-bottom: 20px;
            width: 95%; /* Make container responsive */
            max-width: 450px; /* Limit size on large screens */
        }

        /* --- Score Board --- */
        #score-board {
            width: 100%;
            text-align: center;
            padding-bottom: 10px;
            margin-bottom: 10px;
            border-bottom: 2px dashed var(--text-color);
        }

        #score {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .controls-text {
            font-size: 0.8em;
            margin: 5px 0;
        }

        #start-button {
            padding: 8px 15px;
            background-color: var(--snake-color);
            color: #111;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
        }

        /* --- Game Board - Base Size --- */
        #game-board {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            grid-template-rows: repeat(20, 1fr);
            width: 300px; /* Default smaller size for mobile first */
            height: 300px;
            border: 3px solid var(--text-color);
            box-sizing: content-box;
        }
        
        /* Media Query for larger screens (Desktops/Tablets) */
        @media (min-width: 600px) {
            #game-board {
                width: 400px;
                height: 400px;
            }
        }

        .cell {
            border: 1px solid var(--grid-line-color);
            box-sizing: border-box;
        }

        .snake {
            background-color: var(--snake-color);
            transition: background-color 0.1s ease-in-out;
        }

        .food {
            background-color: var(--food-color);
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        /* --- Game Over Screen --- */
        #game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            z-index: 100;
            text-align: center;
        }
        
        /* --- On-Screen Controls --- */
        #on-screen-controls {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            width: 200px; /* Increased size for easy mobile tapping */
            height: 200px;
            margin-top: 10px;
        }

        .control-btn {
            background-color: var(--snake-color);
            color: #111;
            border: 2px solid var(--text-color);
            padding: 10px;
            font-size: 1.5em; /* Increased font size */
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }

        #up-btn { grid-area: up; }
        #down-btn { grid-area: down; }
        #left-btn { grid-area: left; }
        #right-btn { grid-area: right; }

        .hidden {
            display: none !important;
        }
    </style>
    
</head>
<body>
 <div id="game-container">
        <div id="score-board">
            <h2>NOKIA SNAKE</h2>
            <div id="score">Score: 0</div>
            <p class="controls-text">விளையாட **அம்பு விசைகள்** அல்லது **கீழே உள்ள பட்டன்களைப்** பயன்படுத்தவும்!</p>
            <p style="font-size: 0.9em; color: #00ff00;">old Memories </p>
            <button id="start-button">விளையாட்டைத் தொடங்கு</button>
        </div>

        <div id="game-board">
            </div>

        <div id="game-over" class="hidden">
            <p>விளையாட்டு முடிந்தது (GAME OVER)!</p>
            <p id="final-score"></p>
            <button onclick="window.location.reload()">மீண்டும் தொடங்க</button>
        </div>
    </div>
    
    <div id="on-screen-controls">
        <button id="up-btn" class="control-btn">▲</button>
        <button id="down-btn" class="control-btn">▼</button>
        <button id="left-btn" class="control-btn">◀</button>
        <button id="right-btn" class="control-btn">▶</button>
    </div>
 
   <script>
        // JS Code starts here
        const BOARD_SIZE = 20;
        const board = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const startButton = document.getElementById('start-button');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');

        // Control buttons
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');


        let snake = [{ x: 10, y: 10 }];
        let food = { x: 15, y: 15 };
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        let score = 0;
        let isGameOver = false;
        let isGameRunning = false;
        let lastRenderTime = 0;
        const gameSpeed = 100;

        // --- Game Initialization & Setup ---
        
        function createBoard() {
            board.innerHTML = '';
            for (let y = 0; y < BOARD_SIZE; y++) {
                for (let x = 0; x < BOARD_SIZE; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    board.appendChild(cell);
                }
            }
        }

        function getCell(pos) {
            return board.querySelector(`.cell[data-x="${pos.x}"][data-y="${pos.y}"]`);
        }

        // --- Core Game Loop and Logic ---

        function gameLoop(currentTime) {
            if (isGameOver || !isGameRunning) return;

            const secondsSinceLastRender = (currentTime - lastRenderTime) / 1000;
            const interval = gameSpeed / 1000;

            if (secondsSinceLastRender < interval) {
                requestAnimationFrame(gameLoop);
                return;
            }

            lastRenderTime = currentTime;

            updateGame();
            drawGame();

            requestAnimationFrame(gameLoop);
        }

        /**
         * சுழற்சி இயக்கம் (Warping) மற்றும் பாம்பு மோதல் மட்டுமே உள்ள updateGame().
         */
        function updateGame() {
            direction = nextDirection;
            
            const head = snake[0];
            let newHead = {
                x: head.x + direction.x,
                y: head.y + direction.y
            };

            // 1. சுவர் மோதல் நீக்கப்பட்டு, சுழற்சி சேர்க்கப்படுகிறது (Wall-less Warping):
            if (newHead.x < 0) {
                newHead.x = BOARD_SIZE - 1; 
            } else if (newHead.x >= BOARD_SIZE) {
                newHead.x = 0;
            }

            if (newHead.y < 0) {
                newHead.y = BOARD_SIZE - 1;
            } else if (newHead.y >= BOARD_SIZE) {
                newHead.y = 0;
            }
            
            // 2. Self Collision Check (பாம்பு தன் வாலில் மோதினால் மட்டும் இறக்கும்):
            // குறிப்பு: பாம்பின் தலை மோதினால் மட்டுமே Game Over.
            if (snake.some(segment => segment.x === newHead.x && segment.y === newHead.y)) {
                endGame(); 
                return;
            }

            snake.unshift(newHead);

            // 3. Food Consumption
            if (newHead.x === food.x && newHead.y === food.y) {
                score++;
                scoreDisplay.textContent = `Score: ${score}`;
                spawnFood();
            } else {
                snake.pop();
            }
        }

        function drawGame() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('snake', 'food');
            });

            snake.forEach(segment => {
                const cell = getCell(segment);
                if (cell) {
                    cell.classList.add('snake');
                }
            });

            const foodCell = getCell(food);
            if (foodCell) {
                foodCell.classList.add('food');
            }
        }

        function spawnFood() {
            let newFoodPos;
            do {
                newFoodPos = {
                    x: Math.floor(Math.random() * BOARD_SIZE),
                    y: Math.floor(Math.random() * BOARD_SIZE)
                };
            } while (snake.some(segment => segment.x === newFoodPos.x && segment.y === newFoodPos.y));

            food = newFoodPos;
        }

        function endGame() {
            isGameOver = true;
            isGameRunning = false;
            finalScoreDisplay.textContent = `உங்களின் இறுதி ஸ்கோர்: ${score}`;
            gameOverScreen.classList.remove('hidden');
            
            document.removeEventListener('keydown', handleKeyPress);
            removeButtonListeners();

            startButton.textContent = 'Game Over';
            startButton.disabled = true;
        }

        // --- Input Handling ---

        function changeDirection(key) {
            if (!isGameRunning) return;
            
            const currentDir = direction;

            switch (key) {
                case 'ArrowUp':
                    if (currentDir.y !== 1) nextDirection = { x: 0, y: -1 };
                    break;
                case 'ArrowDown':
                    if (currentDir.y !== -1) nextDirection = { x: 0, y: 1 };
                    break;
                case 'ArrowLeft':
                    if (currentDir.x !== 1) nextDirection = { x: -1, y: 0 };
                    break;
                case 'ArrowRight':
                    if (currentDir.x !== -1) nextDirection = { x: 1, y: 0 };
                    break;
            }
        }

        function handleKeyPress(e) {
            changeDirection(e.key);
        }

        function addButtonListeners() {
            upBtn.addEventListener('click', () => changeDirection('ArrowUp'));
            downBtn.addEventListener('click', () => changeDirection('ArrowDown'));
            leftBtn.addEventListener('click', () => changeDirection('ArrowLeft'));
            rightBtn.addEventListener('click', () => changeDirection('ArrowRight'));
        }

        function removeButtonListeners() {
            // Note: For simplicity and avoiding complex event tracking on button elements, 
            // the buttons remain on the screen but are only functional when isGameRunning is true.
        }
        
        // --- Game Flow ---

        function startGame() {
            if (isGameRunning) return;

            snake = [{ x: 10, y: 10 }];
            direction = { x: 1, y: 0 };
            nextDirection = { x: 1, y: 0 };
            score = 0;
            isGameOver = false;
            isGameRunning = true;
            scoreDisplay.textContent = `Score: 0`;

            gameOverScreen.classList.add('hidden');
            startButton.classList.add('hidden');
            
            spawnFood();
            createBoard();
            drawGame();

            document.addEventListener('keydown', handleKeyPress);
            // Add listeners on game start
            addButtonListeners(); 
            
            requestAnimationFrame(gameLoop);
        }

        startButton.addEventListener('click', startGame);

        // Initial setup
        createBoard();
    </script>
 
</body>
</html>
